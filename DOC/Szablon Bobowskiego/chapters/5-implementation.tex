\chapter{Sample Implementation}
\thispagestyle{chapterBeginStyle}

In this chapter we present simple implementation of Credential System with multiple issuers and verifiers. The goal is to present practical examples, some of the calculations and structures for practical clarification.

\section{Simple Infrastructure (Marandil City)}
Marandil is a fictional city which was founded on the idea of freedom and privacy. It incorporates many systems extending privacy and the CreS is one of those. We will consider the small subset of activities that Bob (a citizen) might perform on his daily basis. A small part of system consists of: 

\begin{itemize}[label=$\circ$]
    \item \textbf{Bob \em{(Credential Wallet)}}
    
    Bob is a user of the system and owner of Credential Wallet. Wallet is a device that holds Bob's attributes and credentials in a secure way. It is meant to interact with many issuers and verifiers while maintaining easy interface for data management.
    
    \item \textbf{Identity Department }
    
    Identity department issues the residence credential for each of its residents. It verifies personal data and issues credentials that assure that the owner is in fact the person and a citizen of Marandil city (we do not consider the philosophical question what it means to be a person, we just assume that it has to possess some of commonly used attributes like name, age etc.). The process requires physical presence in the department, that is why person's attributes are provided in plain-text.
    
    \item \textbf{Museums and Art Galleries}
    
    Museums and other art galleries are available for free, but only for citizens of Marandil city.
    
    \item \textbf{Public Transport}
    
    Non-transferable monthly tickets for the public transport in the city.
    
    % \item \textbf{Pubs and Bars}
    % Allowed 
    % Access to some of resources in the internet is available only after 
    
    % \item \textbf{University}
    
    % University is an institution that issues credentials for students of the university.
    
    % \item \textbf{Public Transport}
    
    % Public transportation institution is a vendor that sells tickets. It offers some discounts based on the profession of the buyer.
    
    \item \textbf{Bars \& Pubs (Age Verification)}
    
    Oblivious age verification allows to verify the age interval of the person without revealing exact value.
    
\end{itemize}


\section{Attributes Convention}
If the system encompasses multiple issuers and verifiers there is a problem with what do certain attributes description actually mean (because attributes are just numbers, they are later interpreted). If there existed some commonly used description system there would be a possibility to automatize some of the processes and also makes it clearer for the standard users what is required of them. Such standardized descriptions is a topic for another documentation (because there is actually a possibility of almost infinite number of attributes, since attributes are just data), here we just propose simple solution for our infrastructure.

\begin{table}[h]

\centering
\renewcommand{\arraystretch}{1.3}
\begin{tabular}{>{\ttfamily\scshape}l >{\ttfamily\scshape}l >{\footnotesize} l}
\hline
\multicolumn{1}{c}{\textbf{UID}} & \multicolumn{1}{c}{\textbf{Type}} & \multicolumn{1}{c}{\textbf{Description}} \\ \hline

\multicolumn{3}{c}{\textbf{Device Attributes}}  \\ \hline
Device\_FamilyID & integer & Serial number of device family \\
Device\_UniqueID & integer & Unique device identification number \\
Device\_SecretKey & integer & Unique device secret key \\ \hline

\multicolumn{3}{c}{\textbf{Personal Identification}}  \\ \hline
Id\_Name & IA5String & First name or names of the person \\
Id\_Surname & IA5String & Surname of the person \\
Id\_Address & IA5String & Corespondence address \\
Id\_DateOfBirth & integer & Date of birth (in days since birth of Nikola Tesla) \\
Id\_PEN & integer & Evidence Number (10 digits) \\ \hline

% \multicolumn{3}{c}{\textbf{Student Identification}}  \\ \hline
% Student\_IndexNumber & integer & Student evidence number (8 digits) \\
% Student\_UniversityName & IA5String & Full name of the university\\
% Student\_Faculty & enumerate & University dependent faculty \\
% Student\_Departament & enumerate & University dependent departament \\
% Student\_FieldOfStudy & enumerate & University dependent field of study \\ \hline

\multicolumn{3}{c}{\textbf{Public Transport Ticket}}  \\ \hline
PubTrans\_TicketType & enumerate & One of ticket types \\
PubTrans\_Entitlement & enumerate & One of entitlements for discounts \\ \hline

% \multicolumn{3}{c}{\textbf{Cinema Ticket}}  \\ \hline
% Cinema\_MovieName & IA5String & Name of the movie \\
% Cinema\_Date & integer & Date of screening (YYYYMMDDhhmm) \\
% Cinema\_RoomNo & integer & Room number in the cinema \\
% Cinema\_SeatNo & integer & Seat number in the room \\

\end{tabular}
\end{table}


\section{Curve Seleciton}
Marandil City head cryptographer \emph{(Mr. Nightingale)} recommended to employ secure and efficient solution for the elliptic curve domain. Namely domain parameters by Nogami et al. / Aranha et al. \cite{kasamatsu-bncurves-02} and recommended sha256 hashing function.

\small
\begin{verbatim}
bnG1Curve G1Curve =
  p_b = 0x2523648240000001ba344d80000000086121000000000013a700000000000013,
  A = 0x0,
  B = 0x2,
  G_1 = {
    x = 0x8b1ef423c291ea8aed4f8af7eed2c4eba9f4c9241a1b339c21af4889b36e5e3,
    y = 0x120be25954367e112c9e06c1e46d181af3329ea10d1f73566044c8915744ab28
  },
  q = 0x2523648240000001ba344d8000000007ff9f800000000010a10000000000000d,
  h = 0x1

bnG2Curve G2Curve =
  p_b = 0x2523648240000001ba344d80000000086121000000000013a700000000000013,
  p_e = [
    0x0,
    -0x1
  ],
  A = 0x0,
  B = [
    0x1,
    -0x1
  ],
  G_2 = {
    x = [
      0xb1eb82108e50b87a2e2191ce897a0199ee4fe4d5f6e4f842d5369aa02908818,
      0x709ded672cebce59d807d09c8de9edacc34430e80484b0cc269ab6d341b42bc
    ],
    y = [
      0x7dbee810770c4c5939f8024426a802240d74bba76c775ab07eacecf76620287,
      0x390e77ca4f38bc1b2153e4de511b73cd6b5f0d63e76befb804676eaf11b459f
    ]
  },
  q = 0x2523648240000001ba344d8000000007ff9f800000000010a10000000000000d,
  h = 0x2523648240000001ba344d8000000008c2a2800000000016ad00000000000019

bnECDomain ECDomain =
  description = 'BN254 Curve -  Nogami et al.',
  hash_fun = 'sha256',
  g1_curve = bnG1Curve,
  g2_curve = bnG2Curve

\end{verbatim}
\normalsize

\section{Personal Identification}

\emph{Only for Personal Identification entity we append all structures to present further calculations. For other entities we only append most crucial structures while omitting calculations.}

\subsection{System Setup}
Issuance of the Residence Credential has to preformed in the proper department of the city and requires physical presence of the person, this is why it assumes that attributes are provided in the open, plain-text form. Below are presented parameters of the issuer, while the \textsf{IdIssuingAgent} is approved by the CA. 

\small
\begin{verbatim}
IdAttributeList AttributeList =
  description = 'Personal Identification Entity - Marandil City',
  commitments = [
    {
      scheme = open,
      attributes = [
        'Id_Name',
        'Id_Surname',
        'Id_Address',
        'Id_DateOfBirth',
        'Id_PEN'
      ]
    }
  ]

IdSecretKey SecretKey =
  x = 0x207bcf42ba5ff98b02e1cc81e41c50bb620a4ba297705faf3ff4e47e9704b297,
  y = 0x20b21c396dd92f4932a69abc2f36d3e8a125b2d8fcf6b5e5b32cc26c760cd201,
  z = [
    0xf3fa266b228a97b3439e7ad63ea4cf0745e2f0ce29246fab275b7b1c2eb6b1a,
    0x227707d04283c78f5bd5c27c74b36d018cf45b202a0dd9140d1f5e7558c45e52,
    0x147cf1bdec23de96ef7162568427cecdd3cb073ecb52c6ae503ac36c5b0f5dc9,
    0x72279eccf95579b7e09e14ee34135427346fa862841e18a8681e4cadb7db52c
  ]

IdPublicKey PublicKey =
  X2 = {
    x = [
      0x18ecf6e306f6bd6b9ce5e21c8cb91ab6d6d3b23616e3d9426c925bfd3ff64edf,
      0x11cba589b15617ba8920477d826158bff2571a2ec24469b14c166f13d3ef02b7
    ],
    y = [
      0x8911f805f9cc27ea53c9db82b825725df464f645edf277de2a04c61bb5886b1,
      0x9450fd3655ebfc6765e61fcc25eacfde47c99b7cea9c063c79fe6cad5fa48d5
    ]
  },
  Y2 = {
    x = [
      0x1f3f8dfc4c59eff593f8ef3c16b7290804308f338e969f5d393f258f367f80a0,
      0x19d8ac4c22e6f2aa8fe18220c029a489521504f008a7262a5ca5ae4f144fe046
    ],
    y = [
      0x6cce177c6609ee9eec200e0b5b3e6808006fe999448ec78d2a769a0b4b3f3aa,
      0x82214b58b2202df3ede3d5b0b9e746df32b60a03f5ee72aebe4d25bc244adcd
    ]
  },
  Z2 = [
    {
      x = [
        0x19be7a2c7cc67fff7713d485b794563cf7fed530199d0e3154c099946375fb7d,
        0x1c9c7252fbd7a0b81bfd8993a4209d7ff8ccbf9e401d0cecebbfb02790165b6b
      ],
      y = [
        0x1bad3ca992398f81d2cbfc4a2cb155374e023534e33de748fc2980e44a6cb860,
        0x1882b3b0e8952d7b69d3cdf3878b73e4095f01c7af6f3d62404b26e7cd2258ed
      ]
    },
    {
      x = [
        0x83368c8680c000f19869529d04826b86af5234f520458893c7e19758da643e7,
        0x14d6098c0557e71718a4a29accb8a32bede4b4622d454f00b7d6b2909efeb053
      ],
      y = [
        0x18e901e911cb47bae4ee56b1bfce7d69f9f70560ec66762e57877665e0181ed2,
        0x10b5036d25f029def5eb46d57558a11638baca69ae967297b46069a23675f7cf
      ]
    },
    {
      x = [
        0xe8c319472af76485fb7b2008d6a679ec3f0681f3affbc5a6e3ad61f39b0ed80,
        0x2c547c8f993c91933938a98d305a0c8f8e4b24d8abf6d106a2d03945bba2786
      ],
      y = [
        0x29e0dfc06dc93b399e0f22fa9526c48060053db2ef2e67a56300fca745ba1a9,
        0x1d29345a58158bc9871f322016ff16bdc62b5e26cf35eb4cdd61744f67cf60f1
      ]
    },
    {
      x = [
        0x106e2c9ce7ac1e685fbaf2d5d012041ae7f93b193089d6a05c167778d73e6e84,
        0x11ca0dbb95abeca3b0d3b7c5ebd771083ba73083dea9b5f252e12fb181d1804c
      ],
      y = [
        0x23b3e952cbb03fbf2b5aaa2ba1617e4352f633a1fcf0d0dbd016c9362b6d66ec,
        0x106a3f9923a4e363515c545d8fed532b32fea91e6c24ce0b2a5211a5f229a29a
      ]
    }
  ],
  Z = [
    {
      x = 0x7e448817712e6b56a3767f958634ea2e7aee15d9ac70a7ab29b67d0d9478a24,
      y = 0xc1a638d3da98376de155438cbfdd4fbf9b5603e533c2faa938f7ad20309a0c1
    },
    {
      x = 0x1d69e5b60d65c899f328a619ef2bef181768f2a954a85522b9dacbf85492fbf9,
      y = 0x1fcb8d19e9a635a03d4a74e55974fd5de968bbef9458a783a4e7db17b1756c2a
    },
    {
      x = 0x9d800588b120c0b612b869ff789e244c260cfbf17df5dce25efb0b2d08b1cfa,
      y = 0x2301c742334f1e79150af246afe4b36314043208c40164532e62d6db457692ef
    },
    {
      x = 0x205f128a3b147439e2c8d62667870811757ff39646fa10552a57cd0e2070b315,
      y = 0x225645636e118d564167f57ed270cc1bcf0739d5212de2fa61c37c93306131f6
    }
  ]

IdIssuingAgent IssuingAgent =
  uid = 0x1,
  ec_domain = bnECDomain,
  attributes = IdAttributeList,
  public_key = IdPublicKey
\end{verbatim}
\normalsize


\subsection{Credential Issuance}

When Bob decided to move to Marandil City he had to obtain a Residence Credential. Apart from some troubles while gathering required documents (actually there weren't any, that is why he got confused) the process went of issuance went without any disturbances.


\textbf{Bob} had to prepare his attributes and sent appropriate commitments.

\begin{table}[h]
\centering
\renewcommand{\arraystretch}{1.3}
\begin{tabular}{>{\ttfamily\scshape}l >{\ttfamily\scshape}l}
\hline
\multicolumn{1}{c}{\textbf{UID}} & \multicolumn{1}{c}{\textbf{Value}} \\ \hline
Id\_Name & Bob  \\
Id\_Surname & Kowalsky  \\
Id\_Address & Main Street 9/11 Marandil \\
Id\_DateOfBirth & 45110 (1980-01-12) \\
Id\_PEN &  9876543210 \\ \hline
\end{tabular}
\end{table}

\small
\begin{verbatim}
bobAttributesCommit AttributesCommit =
  open = [
    Bob,
    Kowalsky,
    Main Street 9/11 Marandil,
    0xb036,
    0x24cb016ea
  ],
  hidden = []
\end{verbatim}

\textbf{Office Worker} checked the validity of the data presented and proceeded to the credential creation.
He transformed attributes sent in plain-text into appropriate values $m_i$ from domain and calculates the message commitment $M$.
Values sent as strings were hashed while the numbers remained without modification.
$M = [m_0]G_1 + [m_1]Z_1 + [m_2]Z_2 + [m_3]Z_3 + [m_4]Z_4$

\begin{verbatim}
m_i = [
  0x13eebb5608ccd83b8b5523c904cc73977197cd1d54d3336a346aa9bb4bb4e920,
  0x1a4e896f1975ef5be0134e8d2e70f697fd76cbada5e30f0f65f795e7dd524a0c,
  0x50da47d55d44e504b61160b157abbf972d3f6c6ed3c5209f472d2d4ac9292e6,
  0x12e2476,
  0x24cb016ea
]
M =
  x = 0xa850342d167019592b90c077d053a7882dfbef49099696b74fdc0e09fa36289,
  y = 0x19800bfd876c5e675ef4229cfcdc1c0c5c2ea2032933ca549d8649b9e6551be3
\end{verbatim}

Because all attributes were sent in \textsf{open} no prove of knowledge was required and the execution continued from signature creation.

For $\alpha = \texttt{0xb21f793cb7127f97c3ae438250b3733bccd514f4b7c625586c6848f2a815297}$.
\begin{verbatim}
id_credential =
  A = [
    {
      x = 0x152be5572aee0f7fee5ff8b94461db93d82c1e997c6b042a7b15a1370f084a8,
      y = 0x2361f7a273ddeac2446c59bd8e480787284386cde0a55dcf0700c957e98dcb5e
    },
    {
      x = 0x1ab209e512d073f4ef3a29ae5c4f389514eb67b8a7d12f94070f84d645554555,
      y = 0x10bfe4565f885dcc7cd07a2f8bb8046016d18d1c3c4283a1e195951e0f07c0ed
    },
    {
      x = 0x23989885d158d2d0b1fe564b72f4ee6618c936ea54322a129776792946778d3c,
      y = 0x15faf52ea77a1a253da66ceff82abdc386454b268d697717a3c30775576bc393
    },
    {
      x = 0x1d2b8021725e54ef2b5d08735f6b2ad55aae2f04bffa89fadecbb7f1f43d5d5a,
      y = 0x2341fbe4fe3b25be7bfe0205ea5e3eb0449e79619ce75195dc58fc851f39a621
    },
    {
      x = 0x1330fc26bf918032f62b8ae04f2c2c786587d55b70a0c780d8d79883769035d1,
      y = 0xa51119a2b9e8787b84f31e6e39187deb1cb9fa4ae88c1be36b555e791f581c8
    }
  ],
  B = [
    {
      x = 0x154db90b2453239d546969372f91c314ab84aa41ded6984483c0caa3debc49ba,
      y = 0x24b6a66aa63d7968f3a4ba14cd3b42695f6133ee906f26c21699243a4c5ed526
    },
    {
      x = 0x946dad1605feabbe8deb0dc72803514bb35fa3b6acb4feb590cb300be544fcd,
      y = 0x21a80c9cdec14bdd272261041cdae5cdc7b8e36c7522f4222169b597ab9ee6c3
    },
    {
      x = 0x221b7c01cb593ea23b13eb42fc504b20a2a237e785ab3c1ed4ae0fdccba3114,
      y = 0x7f24c940374ea692664c90bfd3a94e1c898cf9d5be9dc72211f6cf6666cfd9f
    },
    {
      x = 0x1335d9537535132c5931fe7ef2e47059e20effaa6ccb1d57debca9484d829efe,
      y = 0x2142af305d1d4426316523c01b062df83bfdc07038b1884425686a74bb1459ab
    },
    {
      x = 0x701c38e2e55eb21fca483e57a51cbd399a0b3e704063572a07f449a06a6bac6,
      y = 0x904dc4565580e4b0b2dd96a2b05ceb23ae0b0cc0843e39212c75bf37c9c0124
    }
  ],
  C = {
    x = 0x244b50813cb4e4fd67b8ca8c6e415c2dc643687b0cceaec06c0d260504e5d367,
    y = 0x19e04bcf593369994339939188a3dc58f3038c03a2f7637730d9614ecb7c1568
  }
\end{verbatim}

\subsection{Credential Verification}
On Thursday evenings Bob likes to extend his knowledge of the past, and visits one of many museum in the city. Because the art and history in Marandil city was decided to be free for all citizens without exceptions already long time ago, he just has to prove the possession of valid Residence Credential. He does it while not disclosing any personal information. Thanks to the ever going improvements in the existing systems the verification took so little time, that Bob did not have to stop while passing the entrance gate.

\emph{\textsf{CommitmentRandom} was appended for testing purposes. Museum does not require any initialization because it perform standard credential verification.}

\begin{verbatim}
AttributesCommit =
  sigma = {
    A = [
      {
        x = 0xb9e61cd6ed0456e9c2e54cb47903cc92b5ea010ed0ec4aa880e146ebcf8ba85,
        y = 0x16c7cd6e6b9cb76acfb894a4fea4709c39621079613a7b1d8773347ad9786319
      },
      {
        x = 0x1c927f2286f1cb4d7e8c0f9e0fe1baf709a259e350a4f38fb012402b7346f3fb,
        y = 0xc35edfd48257cdad926280d6938287c0c8eee8e2fca7a6195c963715cd039cf
      },
      {
        x = 0x441b3bf6a68cbc09b8a828650d0c3943baa6a42a2750030a7ea6e9a1da30a65,
        y = 0xb44d8434e4328dd7572173ec159a3ee3ed4d8f0688ebc843af470025730e45d
      },
      {
        x = 0xa176d0943f1eac3a8c487889f0874cba37af50e9f5ec835978ba086a0fc193c,
        y = 0x144b4145c5db5b1362deea311bce208fd7edfc12965c8b9b3548f59822d419d7
      },
      {
        x = 0xe67369d0b75c59fb5957a5a4f80e6aaae11a6b2252979fe34710e1628958dd6,
        y = 0xeea99cb51a696201127746807ad5ec3a1e5a02e85615e075b817a49bd3bcb95
      }
    ],
    B = [
      {
        x = 0x1612ace5176e8b42cde85f7abdc1cb84a1078062e7b3f0c281605e4f09231236,
        y = 0x1a2abcd0225b3849d7255f99e92467f71807f1bd11183f498b30acec5686495c
      },
      {
        x = 0x1b172f9b54a3802b716cc6deb50a34063a3b628532a7ef381071e10b0974d121,
        y = 0x1850c1322940c8db7b6d522cdcad8514f5178e02575ff5cd3b2df7aefe9f3fef
      },
      {
        x = 0x13b71e1a59dab011cd55aea91314d8370d2c4ae4eca75132dff42536bead28ac,
        y = 0x12490f563b61697a550f3ccc6a3d13cc92b68c57fe46dce47af235fed086dd41
      },
      {
        x = 0x17d4bb0754240bf04efc344bbe36a9830c0afee10bca12c508db875e766f2113,
        y = 0x464a3c8ce0c1ccc6353761b68c4f2f9ac01b963144ea8f8b67ec7e0a2fb94a5
      },
      {
        x = 0x1aa57371b78c5dbe225f79c4b104e8e8b0609199322d4a844e900d24f9c2ccae,
        y = 0x918ea334ea4778aa4206e4b65f4f2c217cccd4787e2bdc2fe88b60b7a37b230
      }
    ],
    C = {
      x = 0xc4f88277608fc529086b7599d3e9219bbb28e9aa01dc18b6b02735c87a50af,
      y = 0x8ba47a6adbd027f56cedaae610779723a6ebe8ca4e765c239b3af2282568b9e
    }
  },
  open = [],
  hidden = []

Commit =
  T = {
    x = 0x3463922d80f90136a075ed5e6637deb85e89f87c15735388cb40e21f724aa83,
    y = 0x88c39c87c35cfa1759c8ad906bb08d40e530f7e71dd44b32b836dfaf5c4aef8
  }

CommitmentRandom =
  r = 0x71ef5a246f605877bbb6a28f3e8a168e84664040822e7ba58186287c676be28,
  r' = 0x1150f58a0cd36e9f2daed5041d77d4eb1bf16cccdc29fbd657459502d6c114c3,
  k_r = 0x93f04edb2871a44b9bf4e1b59ba19c905ae54fac9c1474df26e7600aa50fc1e,
  k_i = [
    0x24838ebf47d8f4b21026d0f985f9992df65fac46386a8218afe23d124302117,
    0xff39aa7fcc758926ff124e2e69b91358d0d9c6654b5c9aa21d10a06b7894d9,
    0xb666866d94092f67e0a5531f8600be7f530e423b81decd84320f40b1cefe8ed,
    0x192e126655f3b8bb7e61dfb94f51b9b22c2d49a9de9324ad70532e7850033d62,
    0x22f9458a9a8b05147ca8ad29e7c3b87d5f81e8f96db2dd08cacbee463cc4ebe,
    0x1fec416907b5e139c1e3e9b2405959d2a361a2bf9390c658afcdfecb8125eaa2,
    0x1285a624154ca1f47f739699685e8e80afadb97bcf4fe1226a1539d4a18daa26
  ]

Challenge =
  c = 0x10823a7377e0757a105b89be572f8ed4f04aa0c0e46aa04ee4a0d61aa7fd8587

Response =
  s_r = 0x4da3d1ed3578c12023ce045a3ee60bfb8b65e5ceb97f139913d24cfd177996,
  s_i = [
    0x23e182c77eb588fee45a1fe99ab7a9d8fe33bd08aafc65aa49fac839fc048bd2,
    0x6ff6f646cc6abdcdaa65f010a29676b5a115c484a24b42d9c2dcb59d5d0f33b,
    0x7a46ba4f561435c2128e141a045296ed4fd32a0de85a5ca5baae96ead8c1b62,
    0x23be796f9edb3bfdc658c35b328546879a937f82e0b9160c84901b726867c63f,
    0x18ae9ac9aebc150a9d7be0d32a044e992e45d298fe6ebfcee35a7c723157389d
  ]
\end{verbatim}
\normalsize


\section{Public Transport}
Non-transferable monthly tickets for the public transport are one of the most common goods bought in the city. Bob buys ticket bound to his credential wallet each month, depending on the mood he chooses one of several types of tickets. The CreS allows to verify just the fact of possession of valid ticket without disclosing the actual data. It is also possible to employ discounts for some entitled people.

\subsection{Setup}
\emph{If one of used commitment schemes is of type \textsf{hiding} remember about additional key (because of randomizing value)}

\small
\begin{verbatim}
PubTransAttributeList AttributeList =
  description = 'Public Transport - Marandil City',
  commitments = [
    {
      scheme = hiding,
      attributes = [
        'Device_FamilyID',
        'Device_UniqueID',
        'Device_SecretKey'
      ]
    },
    {
      scheme = hiding,
      attributes = [
        'PubTrans_TicketType'
      ]
    },
    {
      scheme = hiding,
      attributes = [
        'PubTrans_Entitlement'
      ]
    }
  ]
\end{verbatim}
\normalsize

\subsection{Credential Issuance}

\textbf{Bob} has to prepare his attributes and send appropriate commitments.
\begin{table}[H]
\centering
\renewcommand{\arraystretch}{1.3}
\begin{tabular}{>{\ttfamily\scshape}l >{\ttfamily\scshape}l}
\hline
\multicolumn{1}{c}{\textbf{UID}} & \multicolumn{1}{c}{\textbf{Value}} \\ \hline
Device\_FamilyID & 0x1337  \\
Device\_UniqueID & 0x1969712d2ba2a8e79702f9960  \\
Device\_SecretKey & 0x1e4bcd7636f360e08aa8327a405e8a72  \\
PubTrans\_TicketType & all\_monthly (42)  \\
PubTrans\_Entitlement & student (123) \\\hline
\end{tabular}
\end{table}

He samples at random $r_1$, $r_2$ and $r_3$ as the randomizes for the commitments and then computes proper \textsf{hidden} commitments

\small
\begin{verbatim}
r_1, r_2, r_3 = RANDOM()

M_1 = [r_1]G_1 + 
      [0x1337]Z_1 +
      [0x1969712d2ba2a8e79702f9960]Z_2 + 
      [0x1e4bcd7636f360e08aa8327a405e8a72]Z_3
M_2 = [r_2]G_1 + [42]Z_4
M_3 = [r_3]G_1 + [123]Z_5

m_0 = r_1 + r_2 + r_3
\end{verbatim}
\normalsize

Continuing the protocol Bob has to remember new value of $m_0$ (and all $r_i$ values if the specialized proofs will be executed).


\noindent\textbf{Issuer}  in the step 7. Verification of Response the $M_H$ is equal to the sum of all commitments $M_H = M_1 + M_2 + M_3$ 


\section{Bars \& Pubs (Age Verification)}

Under-age drinking was never a problem in Marandil city. Oblivious verification of age from Residence Credential reduced the time and effort necessary for age verification to milliseconds.

\emph{Each month Marandil City organizes public meeting to exchange ideas with residents and share new solutions to everyday problems. Last month the proposal of incorporation of oblivious age verification into online-transactions was discussed. The topic was started by worrying parents that feared their kids would buy something that is not appropriate for their age (by accident of course). The topic has been put under further consideration.}

\subsection{Setup}

\small
\begin{verbatim}
BarAttributeList AttributeList =
  description = 'Some Bar or Pub - Marandil City',
  commitments = [
    {
      scheme = hiding,
      attributes = [
        'ID_DateOfBirth'
      ]
    }
  ]

BarVerifyingAgent VerifyingAgent =
  uid = 0x42,
  verify_uid = 0x1,
  ec_domain = bnECDomain,
  attributes = BarAttributesList,
  bases = barBases       
\end{verbatim}
\normalsize


\subsection{Credential Verification}

\textbf{Bob} has to prepare this Residence Credential and a commitment of the birth date.
He samples $r$ as the randomizing value of the commitment and then computes proper \textsf{hidden} comitment.

\begin{verbatim}
r = RANDOM()

M_1 = [r]G_1 + [age]Z_1
\end{verbatim}

Continuing the protocol Bob proves that age in the additional commitment and in his ID is the same. After validation of credential the range check on age commitemnt is performed.